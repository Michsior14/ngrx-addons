"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[23],{8948(e,n,t){t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>p,frontMatter:()=>a,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"persist-state/advanced","title":"Advanced Usage","description":"Excluding / Including Keys","source":"@site/docs/persist-state/advanced.md","sourceDirName":"persist-state","slug":"/persist-state/advanced","permalink":"/ngrx-addons/docs/persist-state/advanced","draft":false,"unlisted":false,"editUrl":"https://github.com/Michsior14/ngrx-addons/tree/main/docs/docs/persist-state/advanced.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"Configuration","permalink":"/ngrx-addons/docs/persist-state/configuration"},"next":{"title":"Getting Started","permalink":"/ngrx-addons/docs/sync-state/getting-started"}}');var r=t(4848),i=t(8453);const a={sidebar_position:3},o="Advanced Usage",d={},c=[{value:"Excluding / Including Keys",id:"excluding--including-keys",level:2},{value:"Performance Optimization",id:"performance-optimization",level:2},{value:"Multiple Storages for the Same Key",id:"multiple-storages-for-the-same-key",level:2},{value:"Initialization Strategies",id:"initialization-strategies",level:2},{value:"<code>BeforeAppInit</code> (default)",id:"beforeappinit-default",level:3},{value:"<code>AfterAppInit</code>",id:"afterappinit",level:3},{value:"Server-Side Rendering (SSR)",id:"server-side-rendering-ssr",level:2}];function l(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"advanced-usage",children:"Advanced Usage"})}),"\n",(0,r.jsx)(n.h2,{id:"excluding--including-keys",children:"Excluding / Including Keys"}),"\n",(0,r.jsxs)(n.p,{children:["Use the ",(0,r.jsx)(n.code,{children:"excludeKeys()"})," and ",(0,r.jsx)(n.code,{children:"includeKeys()"})," operators from ",(0,r.jsx)(n.code,{children:"@ngrx-addons/common"})," to control which parts of the state are persisted:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"import { excludeKeys, includeKeys } from '@ngrx-addons/common';\nimport { PersistStateModule, localStorageStrategy } from '@ngrx-addons/persist-state';\n\nPersistStateModule.forRoot<typeof reducers>({\n  states: [\n    {\n      key: 'counter',\n      storage: localStorageStrategy,\n      // Only persist specific keys\n      source: (state) => state.pipe(includeKeys(['count', 'name'])),\n      // Or exclude specific keys\n      // source: (state) => state.pipe(excludeKeys(['temporaryFlag'])),\n    },\n  ],\n});\n"})}),"\n",(0,r.jsx)(n.h2,{id:"performance-optimization",children:"Performance Optimization"}),"\n",(0,r.jsxs)(n.p,{children:["By default, state is saved on every change (with a ",(0,r.jsx)(n.code,{children:"distinctUntilChanged"})," check). For high-frequency updates, use ",(0,r.jsx)(n.code,{children:"debounceTime"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"import { debounceTime } from 'rxjs/operators';\nimport { localStorageStrategy } from '@ngrx-addons/persist-state';\n\nprovidePersistStore({\n  states: [\n    {\n      key: 'counter',\n      storage: localStorageStrategy,\n      source: (state) => state.pipe(debounceTime(1000)),\n    },\n  ],\n});\n"})}),"\n",(0,r.jsx)(n.h2,{id:"multiple-storages-for-the-same-key",children:"Multiple Storages for the Same Key"}),"\n",(0,r.jsx)(n.p,{children:"You can persist different parts of the same reducer key to different storages:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"providePersistStore({\n  states: [\n    {\n      key: 'user',\n      storage: localStorageStrategy,\n      source: (state) => state.pipe(includeKeys(['preferences'])),\n      storageKey: 'user-prefs@store',\n    },\n    {\n      key: 'user',\n      storage: sessionStorageStrategy,\n      source: (state) => state.pipe(includeKeys(['session'])),\n      storageKey: 'user-session@store',\n    },\n  ],\n});\n"})}),"\n",(0,r.jsx)(n.h2,{id:"initialization-strategies",children:"Initialization Strategies"}),"\n",(0,r.jsx)(n.p,{children:"Control when rehydration happens relative to app initialization:"}),"\n",(0,r.jsxs)(n.h3,{id:"beforeappinit-default",children:[(0,r.jsx)(n.code,{children:"BeforeAppInit"})," (default)"]}),"\n",(0,r.jsxs)(n.p,{children:["State is rehydrated immediately, before ",(0,r.jsx)(n.code,{children:"APP_INITIALIZER"})," completes. Your app starts with the persisted state already in the store."]}),"\n",(0,r.jsx)(n.h3,{id:"afterappinit",children:(0,r.jsx)(n.code,{children:"AfterAppInit"})}),"\n",(0,r.jsxs)(n.p,{children:["State is rehydrated after ",(0,r.jsx)(n.code,{children:"APP_INITIALIZER"})," completes. Useful when your initializers depend on the default state:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"import { AfterAppInit } from '@ngrx-addons/common';\n\nprovidePersistStore({\n  strategy: AfterAppInit,\n  states: [...],\n});\n"})}),"\n",(0,r.jsxs)(n.p,{children:["When using ",(0,r.jsx)(n.code,{children:"AfterAppInit"}),", call ",(0,r.jsx)(n.code,{children:"markAsInitialized()"})," to trigger rehydration:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"import { AfterAppInit } from '@ngrx-addons/common';\n\n@Component({ ... })\nexport class AppComponent {\n  private readonly afterAppInit = inject(AfterAppInit);\n\n  ngOnInit() {\n    this.afterAppInit.markAsInitialized();\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"server-side-rendering-ssr",children:"Server-Side Rendering (SSR)"}),"\n",(0,r.jsxs)(n.p,{children:["The default ",(0,r.jsx)(n.code,{children:"runGuard"})," checks ",(0,r.jsx)(n.code,{children:"typeof window !== 'undefined'"}),", which prevents persistence from running on the server. No additional configuration is needed for Angular Universal / SSR."]}),"\n",(0,r.jsxs)(n.p,{children:["For testing, use ",(0,r.jsx)(n.code,{children:"noopStorage"})," to disable persistence entirely:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"import { noopStorage } from '@ngrx-addons/persist-state';\n\n// In your test module\nprovidePersistStore({\n  states: [{ key: 'counter', storage: noopStorage }],\n});\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Or provide a custom ",(0,r.jsx)(n.code,{children:"runGuard"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"providePersistStore({\n  states: [\n    {\n      key: 'counter',\n      storage: localStorageStrategy,\n      runGuard: () => false, // Disable persistence\n    },\n  ],\n});\n"})})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},8453(e,n,t){t.d(n,{R:()=>a,x:()=>o});var s=t(6540);const r={},i=s.createContext(r);function a(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);